<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- å¼•å…¥elementuiæ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="./plugins/elementui/index.css" />
    <link rel="shortcut icon" href="./images/ai.jfif" type="image/x-icon" />
    <link rel="stylesheet" href="./css/style.css" />
    <title>ALLGPT</title>
  </head>
  <body>
    <div id="app">
      <span id="logo">ALLGPT</span>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 120">
        <path
          fill="#0099ff"
          fill-opacity="1"
          d="M0,96L80,101.3C160,107,320,117,480,106.7C640,96,800,64,960,58.7C1120,53,1280,75,1360,85.3L1440,96L1440,0L1360,0C1280,0,1120,0,960,0C800,0,640,0,480,0C320,0,160,0,80,0L0,0Z"
        ></path>
      </svg>
      <div id="content" refs="content">
        <div class="ai">
          <div class="ai-info">
            <img id="firstImg" src="./images/ai.jfif" alt="" />
            <div class="answer info">æ¬¢è¿æ¥åˆ°ALLGPTğŸˆ</div>
          </div>
        </div>
        <div class="ai">
          <div class="ai-info">
            <img id="firstImg" src="./images/ai.jfif" alt="" />
            <div class="answer info">è¯·å…ˆé€‰æ‹©æ“ä½œï¼Œå†è¿›è¡Œè¾“å…¥/é€‰æ‹©æ–‡ä»¶â˜€ï¸</div>
          </div>
        </div>
      </div>
      <div id="footer" @keyup.enter="submit">
        <el-cascader v-model="value" :options="options"></el-cascader>
        <el-input
          v-model="inputText"
          :disabled="noselect"
          placeholder="è¯·å…ˆè¿›è¡Œé€‰æ‹©"
          v-show="!showFile"
          @keyup.enter="submit"
        ></el-input>
        <el-input
          v-show="showFile"
          @change.native="addPic($event)"
          type="file"
          v-model="inputPic"
          accept="image/png, image/jpg, image/jpeg"
          :disabled="noselect"
          placeholder="è¯·é€‰æ‹©æ–‡ä»¶ï¼Œé€‰æ‹©å°†è‡ªåŠ¨ä¸Šä¼ "
        ></el-input>
        <el-button @click="submit" v-show="showButton">ç¡®å®š</el-button>
      </div>
    </div>
    <!--å¼•å…¥ vue-->
    <script src="./plugins/vue/vue.js"></script>
    <!--å¼•å…¥ axios-->
    <script src="./plugins/vue/axios.min.js"></script>
    <!-- å¼•å…¥ç»„ä»¶åº“ -->
    <script src="./plugins/elementui/index.js"></script>
    <script>
      new Vue({
        el: '#app',
        data: {
          value: [],
          options: [
            {
              value: 'chat',
              label: 'å” å” å—‘',
            },
            {
              value: 'yuyan',
              label: 'è¯­è¨€',
              children: [
                {
                  value: 'text2voiceMin',
                  label: 'æ–‡æœ¬åˆæˆ',
                },
              ],
            },
            {
              value: 'shibie',
              label: 'é€šç”¨è¯†åˆ«',
              children: [
                {
                  value: 'wordSearch',
                  label: 'é€šç”¨æ–‡å­—è¯†åˆ«',
                },
                {
                  value: 'workSearch',
                  label: 'åŠå…¬æ–‡æ¡£è¯†åˆ«',
                },
                {
                  value: 'perSearch',
                  label: 'äººä½“æ£€æµ‹ä¸å±æ€§è¯†åˆ«',
                },
                {
                  value: 'goodSearch',
                  label: 'ç‰©ä½“è¯†åˆ«',
                },
                ,
                {
                  value: 'carSearch',
                  label: 'è½¦è¾†è¯†åˆ«',
                },
                {
                  value: 'logoSearch',
                  label: 'logoè¯†åˆ«',
                },
                {
                  value: 'plantSearch',
                  label: 'æ¤ç‰©è¯†åˆ«',
                },
              ],
            },
            {
              value: 'tuxiang',
              label: 'å›¾åƒ',
              children: [
                {
                  value: 'pictureFix',
                  label: 'å›¾åƒä¿®å¤',
                },
                {
                  value: 'blackWhite',
                  label: 'é»‘ç™½å›¾ç‰‡ä¸Šè‰²',
                },
                {
                  value: 'dongman',
                  label: 'äººåƒåŠ¨æ¼«åŒ–',
                },
              ],
            },
          ],
          showFile: false,
          fileList: [],
          inputText: '',
          inputPic: null,
          noselect: true,
          showButton: true,
        },
        methods: {
          submit(e) {
            let text = this.inputText;
            // å¦‚æœå½“å‰é€‰æ‹©ä¸ºchat
            if (this.value[0] == 'chat') {
              // åˆ¤æ–­è¾“å…¥æ¡†æ˜¯å¦ä¸ºç©º
              if (!this.inputText.trim()) {
                return this.$message('è¾“å…¥æ¡†ä¸èƒ½ä¸ºç©ºå“¦');
              }
              // åˆ›å»ºæˆ‘çš„æ¶ˆæ¯
              let qesSpan = document.createElement('span');
              qesSpan.innerHTML = this.inputText;
              this.meAppend(qesSpan);
              // å¦‚æœåŒ…å«æ—¶é—´ï¼Œè¿”å›æ—¶é—´
              if (this.inputText.includes('æ—¶é—´')) {
                let aiSpan = document.createElement('span');
                let date = new Date();
                aiSpan.innerHTML = date.toLocaleString();
                this.inputText = '';
                return this.aiAppend(aiSpan);
              } else if (this.inputText.includes('å¤©æ°”')) {
                // è¿”å›å¤©æ°”
                let city = this.inputText.split('å¤©æ°”')[0];
                console.log(city);
                this.inputText = '';
                let appcode = ' b1d83ef16dd74e719a884a18b3e7b31c';
                let config = {
                  headers: {
                    Authorization: 'APPCODE' + appcode,
                  },
                  query: {
                    city: city,
                  },
                };
                return axios
                  .get(
                    'https://jisutqybmf.market.alicloudapi.com/weather/query?city=' +
                      config.query.city,
                    config
                  )
                  .then((res) => {
                    let result = {
                      city: res.data.result.city,
                      date: res.data.result.date,
                      week: res.data.result.week,
                      weather: res.data.result.weather,
                      temp: res.data.result.temp,
                      temphigh: res.data.result.temphigh,
                      templow: res.data.result.templow,
                      updatetime: res.data.result.updatetime,
                    };
                    let weaUl = document.createElement('ul');
                    weaUl.style.listStyle = 'none';
                    for (let i in result) {
                      let li = document.createElement('li');
                      if (i == 'city') {
                        li.innerHTML = 'ğŸ›ï¸åŸå¸‚ï¼š' + result[i];
                      }
                      if (i == 'date') {
                        li.innerHTML = 'ğŸ•æ—¥æœŸï¼š' + result[i];
                      }
                      if (i == 'week') {
                        li.innerHTML = 'ğŸ’«æ˜ŸæœŸï¼š' + result[i];
                      }
                      if (i == 'weather') {
                        li.innerHTML = 'ğŸ“å¤©æ°”:' + result[i];
                      }
                      if (i == 'temp') {
                        li.innerHTML = 'ğŸŒˆå½“å‰æ¸©åº¦ï¼š' + result[i];
                      }
                      if (i == 'temphigh') {
                        li.innerHTML = 'ğŸŒ¡ï¸æœ€é«˜æ¸©åº¦ï¼š' + result[i];
                      }
                      if (i == 'templow') {
                        li.innerHTML = 'â„ï¸æœ€ä½æ¸©åº¦ï¼š' + result[i];
                      }
                      if (i == 'updatetime') {
                        li.innerHTML = 'âš¡æ›´æ–°æ—¶é—´ï¼š' + result[i];
                      }

                      weaUl.appendChild(li);
                    }
                    return this.aiAppend(weaUl);
                    // console.log(result);
                  });
              }
              // è¯­è¨€å›å¤
              let access_token = localStorage.getItem('access_token');
              if (!access_token) {
                return axios
                  .post('/getAccess')
                  .then((res) => {
                    localStorage.setItem('access_token', res.data.access_token);
                  })
                  .catch((err) => {
                    console.log(err);
                  });
              }
              console.log(this.inputText);
              axios
                .post('/chat', {
                  access_token: access_token,
                  text: this.inputText,
                })
                .then((res) => {
                  let result = res.data.items[0].replies[0];
                  let aispan1 = document.createElement('span');
                  if (!result) {
                    aispan1.innerHTML = 'ä¸ä¿¡';
                    return this.aiAppend(aispan1);
                  }
                  aispan1.innerHTML = result + 'ğŸ˜„';
                  this.aiAppend(aispan1);
                });

              return (this.inputText = '');
            }
            switch (this.value[1]) {
              case 'text2voiceMin':
                let qesSpan = document.createElement('span');
                qesSpan.innerHTML = this.inputText;
                this.meAppend(qesSpan);
                if (!this.inputText) {
                  return this.$message('è¾“å…¥æ¡†ä¸èƒ½ä¸ºç©ºå“¦');
                }
                this.inputText = '';
                axios
                  .post('/text2voice', { text: text })
                  .then((res) => {
                    let audio = document.createElement('audio');
                    audio.setAttribute('src', './temp/audio/' + res.data);
                    audio.setAttribute('controls', 'true');
                    this.aiAppend(audio);
                  })
                  .catch((err) => {
                    console.log(err.message);
                  });
                break;
            }
          },
          addPic(e) {
            let picture = e.target.files[0];
            const image = document.createElement('img');
            image.style.height = '250px';
            const reader = new FileReader();
            reader.readAsDataURL(picture);
            reader.onload = function () {
              image.src = this.result;
              window.file = picture;
            };
            this.meAppend(image);

            let param = new FormData();
            param.append('files', picture);
            this.inputPic = '';
            if (this.value[1] == 'wordSearch') {
              axios
                .post('/wordSearch', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  let result = res.data.data.words_result;
                  let ul = document.createElement('ol');
                  ul.innerHTML = 'è¯†åˆ«å†…å®¹å¦‚ä¸‹ï¼š';
                  for (let i in result) {
                    let li = document.createElement('li');
                    li.innerHTML = result[i].words;
                    ul.appendChild(li);
                  }
                  this.aiAppend(ul);
                })
                .catch((err) => {
                  console.log(err);
                });
            } else if (this.value[1] == 'workSearch') {
              axios
                .post('/workSearch', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  let result = res.data.data.results;
                  let ul = document.createElement('ol');
                  ul.style.paddingLeft = '20px';
                  ul.innerHTML = 'è¯†åˆ«å†…å®¹å¦‚ä¸‹ï¼š';
                  for (let i in result) {
                    let li = document.createElement('li');
                    li.innerHTML = result[i].words.word;
                    ul.appendChild(li);
                  }
                  console.log(result);
                  this.aiAppend(ul);
                })
                .catch((err) => {
                  console.log(err);
                });
            } else if (this.value[1] == 'perSearch') {
              axios
                .post('/perSearch', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  console.log(res.data.data);
                  let personNum = res.data.data.person_num;
                  let personInfo = res.data.data.person_info;
                  let ul = document.createElement('ol');
                  ul.style.paddingLeft = '20px';
                  ul.innerHTML = 'è¯†åˆ«åˆ°å…±æœ‰' + personNum + 'ä¸ªäºº';
                  for (let i in personInfo) {
                    let li = document.createElement('li');
                    let person = {
                      age: personInfo[i].attributes.age.name,
                      gender: personInfo[i].attributes.gender.name,
                      orientation: personInfo[i].attributes.orientation.name,
                      upper_wear_fg: personInfo[i].attributes.upper_wear_fg.name,
                    };
                    console.log(person);
                    let o = 1 * i + 1;
                    li.innerHTML = `æ£€æµ‹åˆ°ç¬¬${o}ä¸ªäººï¼š
                    å¹´é¾„ï¼š${person.age}
                    æ€§åˆ«ï¼š${person.gender}
                    çŠ¶æ€ï¼š${person.orientation}
                    ç€è£…ï¼š${person.upper_wear_fg}
                    `;
                    ul.appendChild(li);
                  }
                  // console.log(result);
                  this.aiAppend(ul);
                })
                .catch((err) => {
                  console.log(err);
                });
            } else if (this.value[1] == 'goodSearch') {
              axios
                .post('/goodSearch', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  res = res.data.data.result;
                  let ul = document.createElement('ol');
                  ul.style.paddingLeft = '20px';
                  ul.innerHTML = 'è®©æˆ‘åº·åº·ï¼Œå¦‚æœæˆ‘æ²¡çŒœé”™çš„è¯ï¼Œè¿™æ˜¯ï¼š';
                  console.log(res);
                  for (let i = 0; i < res.length; i++) {
                    let li = document.createElement('li');
                    li.innerHTML = `
                    æœ‰${Math.floor(res[i].score * 100)}%å¯èƒ½æ˜¯ï¼š${res[i].keyword}
                    `;
                    ul.appendChild(li);
                  }
                  this.aiAppend(ul);
                })
                .catch((err) => {
                  console.log(err);
                });
            } else if (this.value[1] == 'carSearch') {
              axios
                .post('/carSearch', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  let color_result = res.data.data.color_result;
                  let result = res.data.data.result;
                  let ul = document.createElement('ol');
                  ul.style.paddingLeft = '20px';
                  ul.innerHTML =
                    'è®©æˆ‘åº·åº·ï¼Œå¦‚æœæˆ‘æ²¡çŒœé”™çš„è¯ï¼Œè¿™ä¸ªè½¦æ˜¯' + color_result + 'çš„å§ï¼Œæˆ‘çŒœä»–æ˜¯ï¼š';
                  for (let i = 0; i < result.length; i++) {
                    let li = document.createElement('li');
                    li.innerHTML = `
                    æœ‰${Math.floor(result[i].score * 100)}%å¯èƒ½æ˜¯ï¼š${result[i].name}
                    ä»–çš„å¹´ä»½å¤§çº¦åœ¨${result[i].year}
                    `;
                    ul.appendChild(li);
                  }
                  this.aiAppend(ul);
                })
                .catch((err) => {
                  console.log(err);
                });
            } else if (this.value[1] == 'logoSearch') {
              axios
                .post('/logoSearch', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  if (res.data.data.error_code) {
                    let errspan = document.createElement('span');
                    errspan.innerHTML = 'ä¸å¥½æ„æ€ç†¬ï¼Œä½ suoè¿™ä¸ªå“ç‰Œæˆ‘ä¸é“';
                    return this.aiAppend(errspan);
                  }
                  let result = res.data.data.result;
                  let ul = document.createElement('ol');
                  ul.style.paddingLeft = '20px';
                  ul.innerHTML = 'è®©æˆ‘åº·åº·ï¼Œå¦‚æœæˆ‘æ²¡çŒœé”™çš„è¯ï¼Œè¿™ä¸ªç‰Œå­æ˜¯ï¼š';
                  for (let i = 0; i < result.length; i++) {
                    let li = document.createElement('li');
                    li.innerHTML = `
                    æœ‰${Math.floor(result[i].probability * 100)}%å¯èƒ½æ˜¯ï¼š${result[i].name}
                    `;
                    ul.appendChild(li);
                  }
                  this.aiAppend(ul);
                })
                .catch((err) => {
                  if (err) {
                    let errspan = document.createElement('span');
                    errspan.innerHTML = 'ä¸å¥½æ„æ€ç†¬ï¼Œä½ suoè¿™ä¸ªå“ç‰Œæˆ‘ä¸é“';
                    this.aiAppend(ul);
                  }
                });
            } else if (this.value[1] == 'plantSearch') {
              axios
                .post('/plantSearch', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  let result = res.data.data.result;
                  let ul = document.createElement('ol');
                  ul.style.paddingLeft = '20px';
                  ul.innerHTML = 'è®©æˆ‘åº·åº·ï¼Œå¦‚æœæˆ‘æ²¡çŒœé”™çš„è¯ï¼Œè¿™ä¸ªæ¤ç‰©ï¼š';
                  for (let i = 0; i < result.length; i++) {
                    let li = document.createElement('li');
                    li.innerHTML = `
                    æœ‰${Math.floor(result[i].score * 100)}%å¯èƒ½æ˜¯ï¼š${result[i].name}
                    `;
                    ul.appendChild(li);
                  }
                  this.aiAppend(ul);
                })
                .catch((err) => {
                  this.$message(err.msg);
                });
            } else if (this.value[1] == 'pictureFix') {
              axios
                .post('/pictureFix', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  let path = res.data.path;
                  let img = document.createElement('img');
                  img.setAttribute('src', path);
                  img.style.height = '250px';
                  this.aiAppend(img);
                })
                .catch((err) => {
                  this.$message(err.msg);
                });
            } else if (this.value[1] == 'blackWhite') {
              axios
                .post('/blackWhite', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  let path = res.data.path;
                  let img = document.createElement('img');
                  img.setAttribute('src', path);
                  img.style.height = '250px';
                  this.aiAppend(img);
                })
                .catch((err) => {
                  console.log(err);
                });
            } else if (this.value[1] == 'dongman') {
              axios
                .post('/dongman', param, {
                  'Content-type': 'multipart/form-data',
                })
                .then((res) => {
                  let path = res.data.path;
                  let img = document.createElement('img');
                  img.setAttribute('src', path);
                  img.style.height = '250px';
                  this.aiAppend(img);
                })
                .catch((err) => {
                  console.log(err);
                });
            }
          },

          // aiå›ç­”
          aiAppend(dom) {
            // å›ç­”æ ‡ç­¾
            let audioDiv = document.createElement('div');
            audioDiv.setAttribute('class', 'answer info');
            // å›¾ç‰‡
            let img = document.createElement('img');
            img.setAttribute('src', './images/ai.jfif');
            img.setAttribute('id', 'firstImg');
            // ai-info
            let ai_info = document.createElement('div');
            ai_info.setAttribute('class', 'ai-info');
            // ai
            let aiDiv = document.createElement('div');
            aiDiv.setAttribute('class', 'ai');
            // æ·»åŠ 
            audioDiv.appendChild(dom);
            ai_info.appendChild(img);
            ai_info.appendChild(audioDiv);
            aiDiv.appendChild(ai_info);
            document.querySelector('#content').appendChild(aiDiv);
          },
          // å®¢æˆ·é—®é¢˜
          meAppend(dom) {
            // å›ç­”æ ‡ç­¾
            let audioDiv = document.createElement('div');
            audioDiv.setAttribute('class', 'question info');
            // å›¾ç‰‡
            let img = document.createElement('img');
            img.setAttribute('src', './images/cat.jpg');
            img.setAttribute('id', 'firstImg');
            // ai-info
            let ai_info = document.createElement('div');
            ai_info.setAttribute('class', 'me-info');
            // ai
            let aiDiv = document.createElement('div');
            aiDiv.setAttribute('class', 'me');
            // æ·»åŠ 
            audioDiv.appendChild(dom);
            ai_info.appendChild(img);
            ai_info.appendChild(audioDiv);
            aiDiv.appendChild(ai_info);
            document.querySelector('#content').appendChild(aiDiv);
          },
        },
        watch: {
          value(newvalue, oldvalue) {
            if (newvalue[0] === 'shibie' || newvalue[0] === 'tuxiang') {
              this.showFile = true;
              this.noselect = false;
              this.showButton = false;
              return;
            }
            this.noselect = false;
            this.showFile = false;
          },
        },
      });
    </script>
  </body>
</html>
